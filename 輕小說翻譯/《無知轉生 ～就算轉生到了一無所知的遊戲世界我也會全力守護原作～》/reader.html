<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>閱讀章節 - 無知轉生 - 輕小說翻譯</title><link rel="icon" href="/images/favicon.jpg" type="image/jpg"><script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script><style>:root{--primary-color:#4a90e2;--secondary-color:#f5f5f5;--text-color:#333;--background-color:#fff;--font-size:18px;--line-height:1.8;--max-width:800px;--content-padding:2rem}:root[data-theme=dark]{--primary-color:#64b5f6;--secondary-color:#1a1a1a;--text-color:#e0e0e0;--background-color:#121212}*{margin:0;padding:0;box-sizing:border-box;transition:background-color .3s}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;line-height:var(--line-height);color:var(--text-color);background-color:var(--secondary-color)}.header-bar{position:fixed;top:0;left:0;right:0;background:rgba(0,0,0,.8);color:#fff;padding:.5rem;z-index:1000;transition:transform .3s}.header-bar.hidden{transform:translateY(-100%)}.header-bar-inner{display:flex;justify-content:space-between;align-items:center;max-width:var(--max-width);margin:0 auto;padding:0 1rem}.chapter-title{text-align:center;flex-grow:1;margin:0 1rem}.chapter-item{padding:.75rem 1rem;cursor:pointer;border-bottom:1px solid #444;transition:background-color .2s}.chapter-item:hover{background:var(--primary-color)}.chapter-item.current{background:var(--primary-color)}.chapter-item.read{opacity:.5}.reader-container{max-width:var(--max-width);margin:4rem auto 5rem;padding:var(--content-padding);background:var(--background-color);border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);font-size:var(--font-size)}.novel-content{margin-bottom:2rem;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.novel-content p{margin-bottom:1rem}.novel-content a{word-break:break-all}.novel-content img{max-width:100%;height:auto;display:block;margin:1rem auto;cursor:pointer;border-radius:4px;transition:transform .2s ease}.novel-content img:hover{transform:scale(1.02)}.image-lightbox{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;z-index:2000;opacity:0;transition:opacity .3s ease}.image-lightbox.active{display:flex;opacity:1}.image-lightbox img{max-width:90%;max-height:90vh;object-fit:contain;border-radius:4px;animation:zoomIn .3s ease}.close-lightbox{position:fixed;top:20px;right:20px;color:#fff;background:0 0;border:none;font-size:24px;cursor:pointer;z-index:2001;padding:10px}.control-btn{padding:.5rem 1rem;border:none;border-radius:4px;background:var(--primary-color);color:#fff;cursor:pointer;min-width:80px}.control-btn:hover{background:#357abd}.control-btn:disabled{opacity:.5;cursor:not-allowed}.back-btn{background:0 0;min-width:auto;padding:.5rem}.back-btn:hover{background:0 0;color:var(--primary-color)}.reader-controls{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,.8);padding:1rem;display:flex;justify-content:center;gap:1rem;transition:transform .3s;z-index:1000}.reader-controls.hidden{transform:translateY(100%)}.settings-modal{position:fixed;bottom:60px;left:50%;transform:translate(-50%,200%);width:300px;background:rgba(0,0,0,.9);border-radius:8px;padding:1.5rem;color:#fff;z-index:1000;transition:transform .3s ease-out;touch-action:none;max-height:60vh;display:flex;flex-direction:column}.settings-modal:nth-child(6){touch-action:none}.settings-modal.active{transform:translate(-50%,0)}.settings-modal-header{position:sticky;top:0;padding:0 0 1rem;border-bottom:1px solid #444;font-weight:700;text-align:center;background:rgba(0,0,0,.9)}.settings-group{margin:1.5rem 0;overflow-y:auto;flex:1;margin:0;padding:1rem 0}.settings-group:last-child{margin-bottom:0}.settings-group label{display:block;margin-bottom:.5rem}.settings-group input[type=range]{width:100%}.settings-group input[type=checkbox]{margin-right:.5rem}.settings-group::-webkit-scrollbar{width:6px}.settings-group::-webkit-scrollbar-track{background:rgba(0,0,0,.1)}.settings-group::-webkit-scrollbar-thumb{background:rgba(255,255,255,.3);border-radius:3px}.settings-group::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.4)}@keyframes zoomIn{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}@media (max-width:768px){:root{--font-size:16px;--content-padding:1rem}.reader-container{margin:3.5rem 0 5rem;border-radius:0;box-shadow:none}.close-lightbox{top:10px;right:10px}.settings-modal{width:90%}}</style></head><body><div id="app"><div class="header-bar" :class="{ hidden: hideControls }"><div class="header-bar-inner"><button class="control-btn back-btn" @click="goToDetail">&lt;</button><div class="chapter-title">{{ currentChapter && currentChapter.title }}</div></div></div><div class="reader-container"><div class="novel-content" v-html="parsedContent"></div></div><div class="image-lightbox" :class="{ active: showImageLightbox }" @click="closeImageLightbox"><button class="close-lightbox" @click.stop="closeImageLightbox">✕</button><img :src="currentImage" alt="" @click.stop></div><div class="settings-modal" :class="{ active: showSettings }"><div class="settings-modal-header">閱讀設置</div><div class="settings-group"><label>字體大小: {{ fontSize }}px</label><input type="range" v-model="fontSize" min="14" max="24" step="1"></div><div class="settings-group"><label>行距: {{ lineHeight }}</label><input type="range" v-model="lineHeight" min="1.5" max="2.5" step="0.1"></div><div class="settings-group"><label><input type="checkbox" v-model="isDarkMode">夜間模式</label></div></div><div class="settings-modal" :class="{ active: showChapterMenu }"><div class="settings-modal-header">章節目錄</div><div class="settings-group"><div v-for="chapter in allChapters" :key="chapter.number" class="chapter-item" :class="{ current: chapter.number === currentChapter.number, read: isChapterRead(chapter.number) }" @click="goToChapter(chapter.number)"><div>{{ chapter.title }}</div></div></div></div><div class="reader-controls" :class="{ hidden: hideControls }"><button class="control-btn" @click="goToPrevious" :disabled="!hasPrevious">上一話</button><button class="control-btn" @click="toggleChapterMenu">目錄</button><button class="control-btn" @click="toggleSettings">設置</button><button class="control-btn" @click="goToNext" :disabled="!hasNext">下一話</button></div></div><script>const NOVEL_INFO={title:"無知轉生 ～就算轉生到了一無所知的遊戲世界我也會全力守護原作～"},STORAGE_KEYS={THEME:"theme",FONT_SIZE:"font_size",LINE_HEIGHT:"line_height",SCROLL_POSITION:"novel_scroll_position",READ_CHAPTERS:"read_chapters"};createApp({data(){return{currentChapter:null,chapterContent:"",hideControls:!1,showSettings:!1,showChapterMenu:!1,showImageLightbox:!1,currentImage:"",lastScrollTop:0,scrollTimeout:null,isDarkMode:"dark"===localStorage.getItem(STORAGE_KEYS.THEME),fontSize:parseInt(localStorage.getItem(STORAGE_KEYS.FONT_SIZE))||18,lineHeight:parseFloat(localStorage.getItem(STORAGE_KEYS.LINE_HEIGHT))||1.8,allChapters:[]}},computed:{parsedContent(){return this.chapterContent?marked.parse(this.chapterContent):""},hasNext(){return this.allChapters.some(e=>e.number>this.currentChapter.number)},hasPrevious(){return this.allChapters.some(e=>e.number<this.currentChapter.number)}},watch:{isDarkMode(e){const t=e?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem(STORAGE_KEYS.THEME,t)},fontSize(e){document.documentElement.style.setProperty("--font-size",`${e}px`),localStorage.setItem(STORAGE_KEYS.FONT_SIZE,e)},lineHeight(e){document.documentElement.style.setProperty("--line-height",e),localStorage.setItem(STORAGE_KEYS.LINE_HEIGHT,e)}},methods:{async fetchChapterData(){try{const e=await fetch("chapters.json"),t=await e.json();this.allChapters=t.chapters.sort((e,t)=>e.number-t.number);const r=new URLSearchParams(window.location.search),a=parseInt(r.get("chapter")),s=this.allChapters.find(e=>e.number===a);if(!s)throw new Error("找不到此章節");this.currentChapter=s,await this.loadChapterContent()}catch(e){console.error("讀取章節失敗:",e),alert("讀取章節失敗"),window.location.href="noveldetail.html"}},async loadChapterContent(){try{const e=await fetch(this.currentChapter.filename);this.chapterContent=await e.text(),this.scrollToTop(),this.$nextTick(()=>{this.setupImageViewer(),this.restoreScrollPosition(),this.markAsRead()})}catch(e){console.error("讀取章節內容失敗:",e),alert("讀取章節內容失敗")}},setupImageViewer(){document.querySelector(".novel-content").addEventListener("click",e=>{"IMG"===e.target.tagName&&(this.currentImage=e.target.src,this.showImageLightbox=!0,this.showSettings=!1,this.showChapterMenu=!1)})},closeImageLightbox(){this.showImageLightbox=!1},saveScrollPosition(){const e=NOVEL_INFO.title,t=JSON.parse(sessionStorage.getItem(STORAGE_KEYS.SCROLL_POSITION)||"{}");t[e]||(t[e]={}),t[e][this.currentChapter.number]=window.pageYOffset,sessionStorage.setItem(STORAGE_KEYS.SCROLL_POSITION,JSON.stringify(t))},restoreScrollPosition(){const e=NOVEL_INFO.title,t=JSON.parse(sessionStorage.getItem(STORAGE_KEYS.SCROLL_POSITION)||"{}"),r=(t[e]||{})[this.currentChapter.number];void 0!==r&&window.scrollTo(0,parseInt(r))},handleScroll(){clearTimeout(this.scrollTimeout);const e=window.pageYOffset||document.documentElement.scrollTop,t=e>this.lastScrollTop,r=window.innerHeight+window.pageYOffset>=document.body.offsetHeight-100;t&&!r?(this.hideControls=!0,this.showSettings=!1,this.showChapterMenu=!1):this.hideControls=!1,this.lastScrollTop=e,this.saveScrollPosition()},toggleSettings(){this.showSettings=!this.showSettings,this.showChapterMenu=!1},toggleChapterMenu(){this.showChapterMenu=!this.showChapterMenu,this.showSettings=!1},goToChapter(e){e!==this.currentChapter.number&&(this.saveScrollPosition(),window.location.href=`reader.html?chapter=${e}`),this.showChapterMenu=!1},goToDetail(){sessionStorage.removeItem(STORAGE_KEYS.SCROLL_POSITION),window.location.href="noveldetail.html"},goToNext(){if(this.hasNext){const e=this.allChapters.filter(e=>e.number>this.currentChapter.number).reduce((e,t)=>t.number<e.number?t:e);this.saveScrollPosition(),window.location.href=`reader.html?chapter=${e.number}`}},goToPrevious(){if(this.hasPrevious){const e=this.allChapters.filter(e=>e.number<this.currentChapter.number).reduce((e,t)=>t.number>e.number?t:e);this.saveScrollPosition(),window.location.href=`reader.html?chapter=${e.number}`}},scrollToTop(){window.scrollTo(0,0)},markAsRead(){const e=JSON.parse(localStorage.getItem(STORAGE_KEYS.READ_CHAPTERS)||"{}");e[NOVEL_INFO.title]||(e[NOVEL_INFO.title]=[]),e[NOVEL_INFO.title].includes(this.currentChapter.number)||(e[NOVEL_INFO.title].push(this.currentChapter.number),localStorage.setItem(STORAGE_KEYS.READ_CHAPTERS,JSON.stringify(e)))},isChapterRead(e){const t=JSON.parse(localStorage.getItem(STORAGE_KEYS.READ_CHAPTERS)||{});return t[NOVEL_INFO.title]?.includes(e)}},mounted(){this.fetchChapterData();const e=localStorage.getItem(STORAGE_KEYS.THEME)||"light";document.documentElement.setAttribute("data-theme",e),document.documentElement.style.setProperty("--font-size",`${this.fontSize}px`),document.documentElement.style.setProperty("--line-height",this.lineHeight),window.addEventListener("scroll",this.handleScroll),document.addEventListener("click",e=>{const t=document.querySelector(".settings-modal"),r=document.querySelector(".settings-modal:nth-child(6)"),a=document.querySelector(".control-btn:nth-child(3)"),s=document.querySelector(".control-btn:nth-child(2)"),n=!t?.contains(e.target)&&!r?.contains(e.target)&&!a?.contains(e.target)&&!s?.contains(e.target);n&&(this.showSettings=!1,this.showChapterMenu=!1)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(this.showImageLightbox?this.closeImageLightbox():(this.showSettings=!1,this.showChapterMenu=!1))}),document.addEventListener("keydown",e=>{this.showImageLightbox||this.showSettings||this.showChapterMenu||("ArrowLeft"===e.key||"ArrowUp"===e.key?this.hasPrevious&&this.goToPrevious():"ArrowRight"!==e.key&&"ArrowDown"!==e.key||!this.hasNext||this.goToNext())})},beforeUnmount(){window.removeEventListener("scroll",this.handleScroll)}}).mount("#app");</script></body></html>
