<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python 程式設計互動教學</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        /* 基本樣式 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Light gray background */
        }
        /* 容器樣式 */
        .container {
            max-width: 800px;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* 標題樣式 */
        h1, h2, h3 {
            color: #1e293b; /* Dark blue-gray */
            margin-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0; /* Light border */
            padding-bottom: 0.5rem;
        }
        h1 { font-size: 1.875rem; font-weight: 600; } /* text-3xl font-semibold */
        h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; } /* text-2xl font-semibold */
        h3 {
            font-size: 1.25rem;
            font-weight: 700; /* 改為 bold */
            margin-top: 1.5rem;
            color: #4f46e5; /* 使用主題靛藍色 */
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
        } /* text-xl font-semibold */
        /* 程式碼區塊樣式 */
        pre {
            background-color: #f1f5f9; /* Lighter gray */
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-x: auto; /* Horizontal scroll if needed */
            margin-bottom: 1rem;
            font-family: monospace;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.5;
        }
        code {
            font-family: monospace;
        }
        /* 練習區樣式 */
        .practice-area {
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            background-color: #f8fafc;
        }
        .practice-area textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1; /* Gray border */
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            font-family: monospace;
            font-size: 0.875rem; /* text-sm */
            min-height: 150px;
            resize: vertical; /* Allow vertical resize */
        }
        .practice-area .output-area {
            background-color: #e2e8f0; /* Slightly darker gray */
            border: 1px solid #cbd5e1;
            min-height: 80px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .practice-area button {
            background-color: #4f46e5; /* Indigo */
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        .practice-area button:hover {
            background-color: #4338ca; /* Darker Indigo */
        }
        .practice-area button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* 測驗區樣式 */
        .quiz-section {
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
            background-color: #f0fdf4; /* Light green background */
        }
        .quiz-section .answers {
            background-color: #dcfce7; /* Slightly darker green */
            padding: 1rem;
            border-radius: 0.375rem;
            margin-top: 1rem;
            border: 1px dashed #86efac; /* Dashed green border */
        }
        .quiz-section button {
            background-color: #16a34a; /* Green */
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            margin-top: 1rem;
        }
        .quiz-section button:hover {
            background-color: #15803d; /* Darker Green */
        }
        .hidden {
            display: none;
        }
        /* 載入指示器 */
        .loading-indicator {
            display: inline-block;
            vertical-align: middle;
            margin-left: 0.75rem;
        }
        .loading-indicator svg {
            animation: spin 1s linear infinite;
            height: 1.25rem; /* h-5 */
            width: 1.25rem; /* w-5 */
            color: #4f46e5; /* Indigo */
            display: inline-block;
            margin-right: 0.25rem;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Python 程式設計互動教學</h1>
        <p class="mb-4 text-gray-600">這份筆記是根據您提供的 PDF 檔案整理而成，包含重點內容、章節測驗與程式碼練習區。</p>
        <div id="globalLoadingIndicator" class="mb-4 text-center p-4 bg-yellow-100 border border-yellow-300 rounded-md text-yellow-800">
            <svg class="animate-spin h-5 w-5 text-yellow-600 inline-block mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span id="globalLoadingText">⏳ 正在初始化 Pyodide 環境，請稍候...</span>
        </div>

        <section id="chapter-1">
            <h2>一、 Python 基礎</h2>
            <h3>Python 特性</h3>
            <ul>
                <li>高階、直譯式程式語言。</li>
                <li><strong>優點</strong>：易學易懂、程式碼可讀性高、免費開源、豐富的第三方套件、開發快速、跨平台。</li>
                <li><strong>缺點</strong>：執行速度相對較慢（特別是巢狀迴圈），可透過使用底層為其他語言的函式庫來改善。</li>
            </ul>
            <h3>基本操作</h3>
            <ul>
                <li><strong>輸出</strong>：使用 <code>print()</code> 函式。
                    <pre><code class="language-python">print('Hello World')</code></pre>
                </li>
                <li><strong>變數賦值</strong>：使用 <code>=</code> 將值指定給變數。
                    <pre><code class="language-python">x = 3.14159
print(x)</code></pre>
                </li>
                <li><strong>輸入</strong>：使用 <code>input()</code> 函式，讀取使用者輸入（注意：讀取到的預設是字串 <code>str</code> 型別）。
                    <pre><code class="language-python">name = input('請輸入姓名:')
print(f"你好, {name}!") # f-string 格式化輸出</code></pre>
                </li>
                <li><strong>註解</strong>：使用 <code>#</code> 符號，該行之後的內容會被忽略。多行註解可用三個單引號 <code>'''</code> 或三個雙引號 <code>"""</code> 包起來。</li>
            </ul>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li>Python 是一種什麼類型的程式語言？ (A) 編譯式 (B) 直譯式 (C) 組合式 (D) 標記式</li>
                    <li>在 Python 中，用於螢幕輸出的函式是什麼？</li>
                    <li><code>name = input("輸入你的名字：")</code> 這行程式碼執行後，變數 <code>name</code> 的資料型別會是什麼？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li>(B) 直譯式</li>
                        <li><code>print()</code></li>
                        <li>字串 (<code>str</code>)</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-1" placeholder="# 在這裡輸入 Python 程式碼&#10;print('歡迎來到 Python 練習區！')&#10;your_age = input('請輸入你的年齡：')&#10;print(f'你輸入的年齡是：{your_age}')"></textarea>
                <button class="run-code-btn" data-input="code-input-1" data-output="output-1" data-loading="loading-1" disabled>執行程式碼</button>
                <span class="loading-indicator hidden" id="loading-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-1" class="output-area"></pre>
            </div>
        </section>

        <section id="chapter-2">
            <h2>二、 變數與資料型別</h2>
            <h3>變數 (Variable)</h3>
             <ul>
                <li>程式執行時儲存資料的標籤。</li>
                <li><strong>命名規則</strong>：
                    <ul class="list-disc list-inside ml-4">
                        <li>不能有空格。</li>
                        <li>不能使用 Python 的關鍵字 (如 <code>if</code>, <code>for</code>, <code>def</code> 等)。</li>
                        <li>大小寫有區分 (<code>myVar</code> 和 <code>myvar</code> 是不同變數)。</li>
                        <li>第一個字元不能是數字。</li>
                        <li>可以使用字母、數字、底線 <code>_</code>。</li>
                    </ul>
                </li>
                <li><strong>命名風格</strong>：
                    <ul class="list-disc list-inside ml-4">
                        <li>駝峰式 (Camel Case)：<code>myVariableName</code></li>
                        <li>蛇形式 (Snake Case)：<code>my_variable_name</code> (Python 常用)</li>
                    </ul>
                </li>
            </ul>
            <h3>資料型別 (Data Types)</h3>
            <ul>
                <li><strong>數值型別 (Numeric Types)</strong>：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>int</code>：整數 (如 <code>10</code>, <code>-5</code>, <code>0</code>)。</li>
                        <li><code>float</code>：浮點數 (有小數點的數，如 <code>3.14</code>, <code>-0.5</code>)。</li>
                        <li><code>bool</code>：布林值，只有 <code>True</code> 和 <code>False</code> 兩個值。</li>
                        <li><code>complex</code>：複數 (如 <code>3+4j</code>)。</li>
                    </ul>
                </li>
                <li><strong>容器型別 (Container Types)</strong>：用來儲存多個資料項目。
                    <ul class="list-disc list-inside ml-4">
                        <li><code>list</code>：串列 (有序、可變更)。</li>
                        <li><code>tuple</code>：元組 (有序、<strong>不可</strong>變更)。</li>
                        <li><code>dict</code>：字典 (鍵值對、無序 [Python 3.7+ 有序]、可變更)。</li>
                        <li><code>set</code>：集合 (無序、元素不重複、可變更)。</li>
                    </ul>
                </li>
                 <li><strong>字串型別 (Sequence Type)</strong>：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>str</code>：字串，用單引號 <code>' '</code> 或雙引號 <code>" "</code> 包起來的文字序列。</li>
                    </ul>
                 </li>
                 <li><strong>型別檢查</strong>：使用 <code>type()</code> 函式查看變數的型別。
                    <pre><code class="language-python">x = 10
print(type(x)) # &lt;class 'int'&gt;
s = "hello"
print(type(s)) # &lt;class 'str'&gt;</code></pre>
                 </li>
                 <li><strong>型別轉換</strong>：使用對應型別的函式轉換，如 <code>int()</code>, <code>float()</code>, <code>str()</code>, <code>list()</code>, <code>tuple()</code>, <code>set()</code>, <code>dict()</code>。
                    <pre><code class="language-python">num_str = "56"
num_int = int(num_str) # 將字串 "56" 轉成整數 56
print(type(num_int)) # &lt;class 'int'&gt;
print(num_int + 4)   # 輸出 60</code></pre>
                 </li>
            </ul>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li>下列哪個變數命名是無效的？ (A) <code>my_var</code> (B) <code>_myVar</code> (C) <code>9lives</code> (D) <code>list1</code></li>
                    <li>布林 (bool) 型別包含哪兩個值？</li>
                    <li>如何將一個浮點數 <code>f = 3.14</code> 轉換成整數？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li>(C) <code>9lives</code> (變數名稱不能以數字開頭)</li>
                        <li><code>True</code> 和 <code>False</code></li>
                        <li>使用 <code>int(f)</code>，結果會是 <code>3</code> (無條件捨去小數)。</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-2" placeholder="# 試試宣告不同型別的變數並印出它們的型別&#10;my_integer = 100&#10;my_float = 99.9&#10;my_string = '台東大學'&#10;my_boolean = True&#10;&#10;print(type(my_integer))&#10;# ... 其他變數"></textarea>
                <button class="run-code-btn" data-input="code-input-2" data-output="output-2" data-loading="loading-2" disabled>執行程式碼</button>
                 <span class="loading-indicator hidden" id="loading-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-2" class="output-area"></pre>
            </div>
        </section>

        <section id="chapter-3">
            <h2>三、 運算子</h2>
            <h3>算術運算子 (Arithmetic Operators)</h3>
            <ul>
                <li><code>+</code>：加法</li>
                <li><code>-</code>：減法</li>
                <li><code>*</code>：乘法 (不可省略)</li>
                <li><code>/</code>：浮點數除法 (結果總是 <code>float</code>)</li>
                <li><code>//</code>：整數除法 (結果取整數部分)</li>
                <li><code>%</code>：模數 (取餘數)</li>
                <li><code>**</code>：指數 (次方)</li>
                <li><strong>運算優先級</strong>：<code>**</code> > (<code>*</code>, <code>/</code>, <code>//</code>, <code>%</code>) > (<code>+</code>, <code>-</code>)。可用括號 <code>()</code> 改變優先級。</li>
            </ul>
            <pre><code class="language-python">print(5 + 2)      # 7
print(10 / 3)     # 3.333...
print(10 // 3)    # 3
print(10 % 3)     # 1
print(2 ** 4)     # 16
print(5 + 2 * 3)  # 11 (先乘除後加減)
print((5 + 2) * 3) # 21 (括號優先)</code></pre>

            <h3>比較運算子 (Comparison Operators)</h3>
            <p>結果為布林值 (<code>True</code> 或 <code>False</code>)。</p>
            <ul>
                <li><code>==</code>：等於</li>
                <li><code>!=</code>：不等於</li>
                <li><code>&gt;</code>：大於</li>
                <li><code>&lt;</code>：小於</li>
                <li><code>&gt;=</code>：大於等於</li>
                <li><code>&lt;=</code>：小於等於</li>
            </ul>
             <pre><code class="language-python">x = 5
y = 10
print(x == 5)     # True
print(x != y)     # True
print(y > 5)      # True
print(x <= 5)     # True</code></pre>

            <h3>邏輯運算子 (Logical Operators)</h3>
            <p>對布林值進行運算。</p>
            <ul>
                <li><code>and</code>：且 (兩者皆 <code>True</code> 才為 <code>True</code>)。</li>
                <li><code>or</code>：或 (至少一者為 <code>True</code> 就為 <code>True</code>)。</li>
                <li><code>not</code>：非 (反轉布林值)。</li>
                <li><strong>優先級</strong>：<code>not</code> > <code>and</code> > <code>or</code>。</li>
            </ul>
             <pre><code class="language-python">a = True
b = False
print(a and b)    # False
print(a or b)     # True
print(not a)      # False
print(not b or a) # True (not 優先)</code></pre>

            <h3>指定運算子 (Assignment Operators)</h3>
            <ul>
                <li><code>=</code>：基本指定。</li>
                <li>複合指定運算子：<code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>//=</code>, <code>%=</code>, <code>**=</code> (例如 <code>a += 1</code> 等同於 <code>a = a + 1</code>)。</li>
            </ul>
             <pre><code class="language-python">count = 0
count += 5 # count 現在是 5
count *= 2 # count 現在是 10
print(count)</code></pre>

            <h3>字串運算子</h3>
             <ul>
                <li><code>+</code>：字串串接。</li>
                <li><code>*</code>：字串重複。</li>
            </ul>
             <pre><code class="language-python">s1 = "哈囉"
s2 = "世界"
print(s1 + ", " + s2 + "!") # 哈囉, 世界!
print(s1 * 3)              # 哈囉哈囉哈囉</code></pre>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li>計算 <code>15 // 4</code> 的結果是什麼？</li>
                    <li>表達式 <code>(5 > 3) and (10 != 10)</code> 的結果是什麼？</li>
                    <li>如果 <code>x = 5</code>，執行 <code>x *= 3</code> 後，<code>x</code> 的值是多少？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li><code>3</code> (整數除法)</li>
                        <li><code>False</code> (因為 <code>10 != 10</code> 是 False，and 運算需要兩邊都為 True)</li>
                        <li><code>15</code> (相當於 <code>x = x * 3</code>)</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-3" placeholder="# 練習不同的運算子&#10;a = 25&#10;b = 4&#10;&#10;print(f'{a} + {b} = {a + b}')&#10;print(f'{a} // {b} = {a // b}')&#10;print(f'{a} % {b} = {a % b}')&#10;&#10;is_greater = a > b&#10;print(f'{a} > {b} is {is_greater}')&#10;&#10;c = True&#10;d = not c&#10;print(f'not {c} is {d}')"></textarea>
                <button class="run-code-btn" data-input="code-input-3" data-output="output-3" data-loading="loading-3" disabled>執行程式碼</button>
                 <span class="loading-indicator hidden" id="loading-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-3" class="output-area"></pre>
            </div>
        </section>

        <section id="chapter-4">
            <h2>四、 資料儲存容器</h2>
            <h3>容器概觀</h3>
            <table class="table-auto w-full border border-collapse border-gray-300 mb-4">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="border p-2 text-left">特性</th>
                        <th class="border p-2 text-left"><code>tuple</code> (元組)</th>
                        <th class="border p-2 text-left"><code>list</code> (串列)</th>
                        <th class="border p-2 text-left"><code>dict</code> (字典)</th>
                        <th class="border p-2 text-left"><code>set</code> (集合)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="border p-2"><strong>有序性</strong></td>
                        <td class="border p-2">是</td>
                        <td class="border p-2">是</td>
                        <td class="border p-2">否 (3.7+ 是)</td>
                        <td class="border p-2">否</td>
                    </tr>
                    <tr>
                        <td class="border p-2"><strong>可變性</strong></td>
                        <td class="border p-2">否</td>
                        <td class="border p-2">是</td>
                        <td class="border p-2">是</td>
                        <td class="border p-2">是</td>
                    </tr>
                     <tr>
                        <td class="border p-2"><strong>表示法</strong></td>
                        <td class="border p-2"><code>()</code></td>
                        <td class="border p-2"><code>[]</code></td>
                        <td class="border p-2"><code>{key:value}</code></td>
                        <td class="border p-2"><code>{}</code></td>
                    </tr>
                     <tr>
                        <td class="border p-2"><strong>重複元素</strong></td>
                        <td class="border p-2">允許</td>
                        <td class="border p-2">允許</td>
                        <td class="border p-2">Key 不允許</td>
                        <td class="border p-2">不允許</td>
                    </tr>
                </tbody>
            </table>

            <h3>Tuple (元組)</h3>
            <ul>
                <li>創建：用逗號 <code>,</code> 分隔元素，通常用 <code>()</code> 包起來 <code>t = (1, 2, 3)</code> 或 <code>t = 1, 2, 3</code>。單一元素的 tuple 需加逗號 <code>t = (1,)</code>。</li>
                <li>索引：同 list，用 <code>[]</code> 取值 <code>t[0]</code>。</li>
                <li><strong>不可變</strong>：創建後不能修改、新增或刪除元素。</li>
                <li>打包/解包：<code>t = 1, 2, 3</code> (打包)，<code>a, b, c = t</code> (解包)。</li>
            </ul>
            <pre><code class="language-python">my_tuple = (10, 'apple', True)
print(my_tuple[1]) # 'apple'
# my_tuple[0] = 20 # 這行會報錯 (TypeError)

point = (100, 200)
x, y = point # 解包
print(f"x={x}, y={y}") # x=100, y=200</code></pre>

            <h3>List (串列)</h3>
            <ul>
                <li>創建：<code>L = []</code> (空串列)，<code>L = [1, 'a', 3.5]</code>。</li>
                <li>索引與切片：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>L[index]</code>：取得索引位置的元素 (從 0 開始，-1 為最後一個)。</li>
                        <li><code>L[start:end:step]</code>：切片，取得子串列。</li>
                        <li><code>L[::-1]</code>：反轉串列。</li>
                    </ul>
                </li>
                 <li>常用方法/函式：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>len(L)</code>：取得長度。</li>
                        <li><code>L.append(item)</code>：在末尾新增元素。</li>
                        <li><code>L.insert(index, item)</code>：在指定索引插入元素。</li>
                        <li><code>L.remove(item)</code>：移除第一個找到的指定元素。</li>
                        <li><code>L.pop(index=-1)</code>：移除並回傳指定索引的元素 (預設最後一個)。</li>
                        <li><code>L.index(item)</code>：找出元素首次出現的索引。</li>
                        <li><code>L.count(item)</code>：計算元素出現次數。</li>
                        <li><code>L.sort()</code>：<strong>原地</strong>排序 (由小到大)。</li>
                        <li><code>sorted(L)</code>：回傳一個<strong>新的</strong>排序好的串列，原串列不變。</li>
                        <li><code>L.reverse()</code>：<strong>原地</strong>反轉串列。</li>
                        <li><code>max(L)</code>, <code>min(L)</code>, <code>sum(L)</code>：最大值、最小值、總和。</li>
                    </ul>
                </li>
                <li>運算：<code>+</code> (串接)，<code>*</code> (重複)。</li>
                <li><strong>複製</strong>：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>L2 = L1</code>：參考賦值，非複製。</li>
                        <li><code>L3 = L1[:]</code> 或 <code>L3 = L1.copy()</code>：淺拷貝 (Shallow Copy)。</li>
                    </ul>
                </li>
            </ul>
             <pre><code class="language-python">fruits = ['apple', 'banana', 'cherry']
fruits.append('orange')
print(fruits)        # ['apple', 'banana', 'cherry', 'orange']
fruits.sort()
print(fruits)        # ['apple', 'banana', 'cherry', 'orange'] (原地排序)
print(fruits[1:3])   # ['banana', 'cherry'] (切片)
print(len(fruits))   # 4</code></pre>

            <h3>Dictionary (字典)</h3>
            <ul>
                <li>創建：<code>d = {}</code> (空字典)，<code>d = {'name': 'David', 'age': 20}</code>。</li>
                <li>特性：儲存鍵值對 (<code>key:value</code>)，Key 必須是<strong>不可變</strong>型別且唯一。</li>
                <li>取值：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>d[key]</code>：若 key 不存在會報錯 (KeyError)。</li>
                        <li><code>d.get(key, default_value)</code>：較安全的方式，key 不存在可回傳預設值。</li>
                    </ul>
                </li>
                <li>新增/修改：<code>d[key] = value</code>。</li>
                <li>刪除：<code>del d[key]</code> 或 <code>d.pop(key)</code>。</li>
                <li>常用方法：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>d.keys()</code>：回傳所有 key。</li>
                        <li><code>d.values()</code>：回傳所有 value。</li>
                        <li><code>d.items()</code>：回傳所有 (key, value) 的 tuple 對。</li>
                        <li><code>d1.update(d2)</code>：合併字典。</li>
                        <li><code>d.copy()</code>：淺拷貝。</li>
                    </ul>
                </li>
                <li>迭代：
                    <pre><code class="language-python">student = {'name': 'Mary', 'major': 'CS', 'grade': 85}
# 迭代 key-value 對
for key, value in student.items():
    print(f"{key}: {value}")</code></pre>
                </li>
            </ul>

            <h3>Set (集合)</h3>
            <ul>
                <li>創建：<code>s = set()</code> (空集合)，<code>s = {1, 2, 3, 'a'}</code>。會自動去除重複元素。</li>
                <li>特性：無序、元素唯一。</li>
                <li>常用方法：
                    <ul class="list-disc list-inside ml-4">
                        <li><code>s.add(item)</code>：新增元素。</li>
                        <li><code>s.remove(item)</code>：刪除元素 (若元素不存在會報錯)。</li>
                        <li><code>s.discard(item)</code>：刪除元素 (若元素不存在**不會**報錯)。</li>
                    </ul>
                </li>
                <li>集合運算：
                    <ul class="list-disc list-inside ml-4">
                        <li>聯集：<code>|</code> 或 <code>.union()</code></li>
                        <li>交集：<code>&</code> 或 <code>.intersection()</code></li>
                        <li>差集：<code>-</code> 或 <code>.difference()</code></li>
                        <li>對稱差集：<code>^</code> 或 <code>.symmetric_difference()</code></li>
                    </ul>
                </li>
                 <li>集合比較：<code><=</code> (子集), <code><</code> (真子集), <code>>=</code> (超集), <code>></code> (真超集)。</li>
            </ul>
             <pre><code class="language-python">set1 = {1, 2, 3, 4}
set2 = {3, 4, 5, 6}
print(set1 | set2) # 聯集: {1, 2, 3, 4, 5, 6}
print(set1 & set2) # 交集: {3, 4}
print(set1 - set2) # 差集: {1, 2}
print(set1 ^ set2) # 對稱差集: {1, 2, 5, 6}</code></pre>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li>串列 (List) 和元組 (Tuple) 最主要的區別是什麼？</li>
                    <li>如何安全地從字典 <code>d</code> 中獲取鍵 <code>'key'</code> 對應的值，如果鍵不存在則回傳 <code>0</code>？</li>
                    <li>集合 (Set) 最重要的特性是什麼？</li>
                    <li>執行 <code>my_list = [10, 20]; new_list = my_list; new_list.append(30)</code> 後，<code>my_list</code> 的內容是什麼？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li>串列是可變的 (mutable)，元組是不可變的 (immutable)。</li>
                        <li>使用 <code>d.get('key', 0)</code>。</li>
                        <li>元素唯一不重複。</li>
                        <li><code>[10, 20, 30]</code>。因為 <code>new_list = my_list</code> 是參考賦值，兩者指向同一個串列物件。</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-4" placeholder="# 練習創建和操作不同的容器&#10;my_list = [5, 1, 4, 1, 3]&#10;my_list.sort()&#10;print(f'排序後的串列: {my_list}')&#10;&#10;my_dict = {'fruit': '蘋果', 'color': '紅色'}&#10;my_dict['price'] = 50 # 新增鍵值對&#10;print(f'字典內容: {my_dict}')&#10;&#10;my_set = set(my_list) # 從串列創建集合，去除重複&#10;print(f'集合內容: {my_set}')"></textarea>
                <button class="run-code-btn" data-input="code-input-4" data-output="output-4" data-loading="loading-4" disabled>執行程式碼</button>
                 <span class="loading-indicator hidden" id="loading-4">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-4" class="output-area"></pre>
            </div>
        </section>

        <section id="chapter-5">
            <h2>五、 Python 流程控制</h2>
            <h3>Python 腳本 (`.py`)</h3>
            <p>將多行程式碼存成 <code>.py</code> 檔，可重複執行。可在 IDLE 或終端機執行。</p>

            <h3><code>if-elif-else</code> 條件判斷</h3>
            <p>根據條件執行不同程式碼區塊，<strong>縮排</strong>非常重要。</p>
            <pre><code class="language-python">score = int(input("請輸入分數：")) # input() 讀取的是字串，需轉成 int

if score >= 90:
    print('等級 A')
elif score >= 80:
    print('等級 B')
elif score >= 60:
    print('等級 C')
else:
    print('等級 F')</code></pre>

            <h3><code>for</code> 迴圈</h3>
            <p>用於迭代序列 (如 list, tuple, string, range)。</p>
            <ul>
                <li><strong><code>range(stop)</code></strong>: 從 0 到 stop-1。</li>
                <li><strong><code>range(start, stop)</code></strong>: 從 start 到 stop-1。</li>
                <li><strong><code>range(start, stop, step)</code></strong>: 從 start 到 stop-1，間隔為 step。</li>
                <li><strong><code>enumerate(iterable)</code></strong>: 同時取得索引和元素。</li>
            </ul>
             <pre><code class="language-python"># 迭代 range
print("迭代 range:")
for i in range(3):
    print(i) # 0, 1, 2

# 迭代 list
print("\n迭代 list:")
my_list = ['a', 'b', 'c']
for item in my_list:
    print(item) # a, b, c

# 使用 enumerate
print("\n使用 enumerate:")
for index, value in enumerate(my_list):
    print(f"索引 {index}: {value}")</code></pre>

            <h3><code>while</code> 迴圈</h3>
            <p>當條件為 <code>True</code> 時重複執行，需確保條件最終會變為 <code>False</code>。</p>
            <pre><code class="language-python">count = 5
while count > 0:
    print(count)
    count -= 1 # 更新條件變數
print("發射！")</code></pre>
            <ul>
                <li><strong><code>break</code></strong>: 強制跳出目前所在的迴圈。</li>
            </ul>
             <pre><code class="language-python"># 找到第一個能被 7 整除的數
num = 1
while True:
    if num % 7 == 0:
        print(f"找到第一個能被 7 整除的數: {num}")
        break # 找到就跳出迴圈
    num += 1</code></pre>

            <h3>巢狀迴圈 (Nested Loops)</h3>
            <p>迴圈內還有迴圈，常用於處理二維結構或多重迭代。</p>
            <pre><code class="language-python"># 印出 3x3 的星號矩陣
for i in range(3):      # 外層迴圈控制行
    for j in range(3):  # 內層迴圈控制列
        print('*', end=' ') # end=' ' 讓 print 不換行，用空格分隔
    print() # 每行結束後換行</code></pre>

            <h3>串列生成式 (List Comprehension)</h3>
            <p>簡潔創建串列的方式：<code>[expression for item in iterable if condition]</code></p>
            <pre><code class="language-python"># 產生 0 到 9 的平方數串列
squares = [x**2 for x in range(10)]
print(squares) # [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]

# 產生 0 到 9 的偶數串列
evens = [x for x in range(10) if x % 2 == 0]
print(evens)   # [0, 2, 4, 6, 8]</code></pre>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li><code>range(2, 8, 2)</code> 會產生哪些數字的序列？</li>
                    <li>在 <code>while</code> 迴圈中，<code>break</code> 陳述句的作用是什麼？</li>
                    <li>寫一個串列生成式，產生包含 <code>['apple', 'banana', 'cherry']</code> 中所有水果長度的串列。</li>
                    <li>巢狀迴圈常用於處理哪種資料結構？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li><code>2, 4, 6</code> (從 2 開始，不包含 8，間隔 2)</li>
                        <li>立即終止並跳出目前所在的迴圈 (for 或 while)。</li>
                        <li><code>lengths = [len(fruit) for fruit in ['apple', 'banana', 'cherry']]</code> 結果會是 <code>[5, 6, 6]</code>。</li>
                        <li>二維結構 (例如矩陣、表格) 或需要多重迭代的場景。</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-5" placeholder="# 練習流程控制&#10;# 試著用 for 迴圈印出 1 到 5 的數字&#10;print('For 迴圈範例:')&#10;# ...&#10;&#10;# 試著用 while 迴圈做同樣的事&#10;print('\\nWhile 迴圈範例:')&#10;# ...&#10;&#10;# 試著用 if-elif-else 判斷輸入數字是正數、負數或零&#10;num_str = input('\\n請輸入一個數字: ')&#10;# ... (記得轉換型別)"></textarea>
                <button class="run-code-btn" data-input="code-input-5" data-output="output-5" data-loading="loading-5" disabled>執行程式碼</button>
                 <span class="loading-indicator hidden" id="loading-5">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-5" class="output-area"></pre>
            </div>
        </section>

        <section id="chapter-6">
            <h2>六、 函式 (Functions)</h2>
            <h3>定義與呼叫</h3>
            <ul>
                <li>目的：程式碼結構化、重用、模組化。</li>
                <li>定義：使用 <code>def</code> 關鍵字。</li>
                <li>呼叫：<code>function_name(arguments)</code>。</li>
            </ul>
            <pre><code class="language-python"># 定義函式
def greet(name):
  """這個函式會向指定的名字打招呼。"""
  print(f"你好, {name}！")

# 呼叫函式
greet("同學") # 輸出: 你好, 同學！</code></pre>

            <h3>參數與引數</h3>
            <ul>
                <li><strong>參數</strong>：定義函式時的變數名稱。</li>
                <li><strong>引數</strong>：呼叫函式時傳遞的實際值。</li>
                <li><strong>位置參數</strong>：按順序傳遞。</li>
                <li><strong>關鍵字參數</strong>：指定參數名稱傳遞 (<code>func(param=value)</code>)。</li>
                <li><strong>預設參數值</strong>：定義時給定預設值 (<code>def func(param=default):</code>)。預設參數必須放在位置參數之後。</li>
                <li><strong><code>*args</code></strong>：收集多餘的位置引數成 tuple。</li>
                <li><strong><code>**kwargs</code></strong>：收集多餘的關鍵字引數成 dict。</li>
                <li><strong>參數順序</strong>：<code>位置參數</code>, <code>*args</code>, <code>關鍵字/預設參數</code>, <code>**kwargs</code>。</li>
            </ul>
            <pre><code class="language-python">def describe_pet(pet_name, animal_type='狗'): # animal_type 有預設值
    print(f"我有一隻{animal_type}。")
    print(f"牠的名字是 {pet_name}。")

describe_pet('旺財')          # 使用預設值 animal_type='狗'
describe_pet('咪咪', '貓')   # 提供 animal_type
describe_pet(animal_type='鳥', pet_name='啾啾') # 使用關鍵字引數

def make_pizza(size, *toppings): # *toppings 收集所有額外的配料
    print(f"\n製作一個 {size} 吋披薩，配料如下：")
    for topping in toppings:
        print(f"- {topping}")

make_pizza(12, '蘑菇', '青椒', '起司')</code></pre>

            <h3>回傳值 (Return Value)</h3>
            <p>使用 <code>return</code> 將結果傳回給呼叫者。若無 <code>return</code>，預設回傳 <code>None</code>。</p>
            <pre><code class="language-python">def add(x, y):
    return x + y

result = add(5, 3)
print(result) # 輸出 8

def no_return():
    print("這個函式沒有 return")

value = no_return()
print(value) # 輸出 None</code></pre>

            <h3>參數傳遞機制 (Pass by Object Reference)</h3>
            <ul>
                <li>Python 傳遞的是物件的「參考」。</li>
                <li><strong>不可變物件 (int, float, str, tuple)</strong>：函式內修改參數會指向新物件，不影響外部。</li>
                <li><strong>可變物件 (list, dict, set)</strong>：函式內修改物件內容會影響外部。若在函式內將參數重新賦值給新物件，則不影響外部。</li>
            </ul>
             <pre><code class="language-python">def modify_list(some_list):
    some_list.append(100) # 修改了原始串列

my_numbers = [1, 2, 3]
modify_list(my_numbers)
print(my_numbers) # [1, 2, 3, 100]

def reassign_list(some_list):
    some_list = [4, 5, 6] # 重新賦值，不影響外部
    print("Inside reassign:", some_list)

my_numbers_2 = [1, 2, 3]
reassign_list(my_numbers_2)
print("Outside reassign:", my_numbers_2) # [1, 2, 3]</code></pre>

            <h3>遞迴函式 (Recursion)</h3>
            <ul>
                <li>函式呼叫自己。</li>
                <li>需要<strong>基本情況 (Base Case)</strong> 終止遞迴。</li>
                <li>需要<strong>遞迴步驟 (Recursive Step)</strong> 分解問題。</li>
            </ul>
            <pre><code class="language-python"># 遞迴計算階層 n! = n * (n-1)!
def factorial(n):
    if n == 0 or n == 1: # 基本情況
        return 1
    else: # 遞迴步驟
        return n * factorial(n - 1)

print(f"5! = {factorial(5)}") # 5! = 120</code></pre>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li>定義函式時使用的關鍵字是什麼？</li>
                    <li>在函式定義 <code>def func(a, b=10):</code> 中，<code>b</code> 稱為什麼參數？</li>
                    <li>如果一個函式沒有 <code>return</code> 陳述句，它會回傳什麼？</li>
                    <li>遞迴函式必須包含哪兩個要素才能正確運作？</li>
                    <li>當將一個串列 (list) 傳遞給函式，並在函式內部使用 <code>.append()</code> 方法時，函式外部的原始串列會不會被改變？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li><code>def</code></li>
                        <li>預設參數 (Default Parameter)</li>
                        <li><code>None</code></li>
                        <li>基本情況 (Base Case) 和 遞迴步驟 (Recursive Step)。</li>
                        <li>會。因為串列是可變物件，函式修改的是同一個物件。</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-6" placeholder="# 練習定義和呼叫函式&#10;# 定義一個計算平方的函式&#10;def square(number):&#10;  # '''計算數字的平方''' # 這是 Docstring&#10;  # ... (完成函式)&#10;  pass # pass 是一個佔位符，表示什麼都不做&#10;&#10;num = 7&#10;# result = square(num) # 呼叫函式&#10;# print(f'{num} 的平方是 {result}')&#10;&#10;# 練習遞迴 (例如計算 1+2+...+n)&#10;def sum_recursive(n):&#10;  # ... (思考基本情況和遞迴步驟)&#10;  pass&#10;&#10;# print(f'1+...+5 = {sum_recursive(5)}')"></textarea>
                <button class="run-code-btn" data-input="code-input-6" data-output="output-6" data-loading="loading-6" disabled>執行程式碼</button>
                 <span class="loading-indicator hidden" id="loading-6">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-6" class="output-area"></pre>
            </div>
        </section>

        <section id="chapter-7">
            <h2>七、 進階函式概念</h2>
            <h3>函式說明文件 (Docstrings)</h3>
            <p>寫在函式定義第一行的三引號字串 <code>"""Docstring"""</code>，用於解釋函式。可透過 <code>help(func)</code> 或 <code>func.__doc__</code> 查看。</p>
            <pre><code class="language-python">def power(base, exp):
    """
    計算 base 的 exp 次方。

    Args:
        base: 基數。
        exp: 指數。

    Returns:
        base 的 exp 次方計算結果。
    """
    return base ** exp

help(power) # 會印出上面的 Docstring
print(power.__doc__) # 也會印出 Docstring</code></pre>

            <h3>函式作為物件</h3>
            <p>函式可以賦值給變數、作為參數傳遞、或從函式回傳。</p>
            <pre><code class="language-python">def shout(text):
    return text.upper() + "!"

yell = shout # 將函式賦值給變數 yell
print(yell("喂")) # 輸出: 喂!

def whisper(text):
    return text.lower() + "..."

def greet(func, message): # 接收函式作為參數
    print(func(message))

greet(shout, "開門")   # 輸出: 開門!
greet(whisper, "有人在嗎") # 輸出: 有人在嗎...</code></pre>

            <h3><code>lambda</code> 函式</h3>
            <p>匿名、單行的函式：<code>lambda arguments: expression</code></p>
            <pre><code class="language-python"># 計算 x+y 的 lambda 函式
add = lambda x, y: x + y
print(add(5, 3)) # 8

# 搭配 sorted() 使用，根據字串長度排序
words = ["香蕉", "蘋果", "橘子"]
sorted_words = sorted(words, key=lambda word: len(word))
print(sorted_words) # ['蘋果', '橘子', '香蕉']</code></pre>

            <h3>產生器 (Generators)</h3>
            <p>使用 <code>yield</code> 回傳值的特殊函式，一次產生一個值，節省記憶體。</p>
            <pre><code class="language-python">def even_numbers(limit):
    n = 0
    while n <= limit:
        if n % 2 == 0:
            yield n # 產生偶數
        n += 1

print("偶數產生器:")
for num in even_numbers(10): # 迭代 generator
    print(num) # 0, 2, 4, 6, 8, 10</code></pre>

            <h3>內部函式 (Inner Functions)</h3>
            <p>在函式內部定義的函式。</p>
            <pre><code class="language-python">def outer_func(x):
    def inner_func(y):
        return x + y # inner_func 可以存取 outer_func 的 x
    
    result = inner_func(5) # 在 outer_func 內部呼叫 inner_func
    print(result)

outer_func(10) # 輸出 15</code></pre>

            <h3>閉包 (Closures)</h3>
            <p>內部函式，即使外部函式結束，仍能存取外部作用域的變數。外部函式通常回傳內部函式。</p>
            <pre><code class="language-python">def make_multiplier(n):
    def multiplier(x):
        return x * n # multiplier 記住了 n 的值
    return multiplier # 回傳內部函式

times_3 = make_multiplier(3) # times_3 現在是一個會乘以 3 的函式
times_5 = make_multiplier(5) # times_5 現在是一個會乘以 5 的函式

print(times_3(9))  # 輸出 27
print(times_5(4))  # 輸出 20</code></pre>

            <h3>裝飾器 (Decorators)</h3>
            <p>用 <code>@decorator_name</code> 語法糖修改或增強函式功能。</p>
            <pre><code class="language-python">import functools

# 定義一個簡單的裝飾器，印出函式執行前後的訊息
def my_decorator(func):
    @functools.wraps(func) # 保留原始函式的元數據(如名稱、docstring)
    def wrapper(*args, **kwargs):
        print(f"準備執行函式: {func.__name__}")
        result = func(*args, **kwargs) # 執行原始函式
        print(f"函式執行完畢: {func.__name__}")
        return result
    return wrapper

@my_decorator # 使用裝飾器
def say_whee():
    print("Whee!")

say_whee()
# 輸出:
# 準備執行函式: say_whee
# Whee!
# 函式執行完畢: say_whee
</code></pre>

            <div class="quiz-section">
                <h3>章節測驗</h3>
                <ol class="list-decimal list-inside space-y-2">
                    <li>如何查看一個函式 <code>my_func</code> 的說明文件 (Docstring)？ (至少寫一種方法)</li>
                    <li><code>lambda x: x * 2</code> 這個 lambda 函式的功能是什麼？</li>
                    <li>產生器 (Generator) 使用哪個關鍵字來回傳值？</li>
                    <li>閉包 (Closure) 的主要特性是什麼？</li>
                    <li>裝飾器語法中，用來應用裝飾器的符號是什麼？</li>
                </ol>
                <button class="toggle-answer-btn">顯示答案</button>
                <div class="answers hidden">
                    <ol class="list-decimal list-inside">
                        <li><code>help(my_func)</code> 或 <code>print(my_func.__doc__)</code></li>
                        <li>接收一個參數 <code>x</code>，並回傳 <code>x</code> 的兩倍。</li>
                        <li><code>yield</code></li>
                        <li>內部函式能夠記住並存取其外部 (封閉) 函式作用域中的變數，即使外部函式已經執行完畢。</li>
                        <li><code>@</code> 符號 (例如 <code>@my_decorator</code>)</li>
                    </ol>
                </div>
            </div>

            <div class="practice-area">
                <h3>程式碼練習區</h3>
                <textarea id="code-input-7" placeholder="# 練習進階函式概念&#10;# 寫一個 lambda 函式檢查數字是否為偶數&#10;is_even = lambda num: # ...&#10;# print(is_even(4))&#10;# print(is_even(5))&#10;&#10;# 試著寫一個簡單的產生器，產生從 1 到 n 的數字&#10;def count_to_n(n):&#10;  # ... 使用 yield&#10;  pass&#10;&#10;# print('\\n產生器:')&#10;# for i in count_to_n(3):&#10;#   print(i)&#10;&#10;# 練習閉包: 創建一個 '加 n' 的函式&#10;def make_adder(n):&#10;  # ...&#10;  pass&#10;&#10;# add_5 = make_adder(5)&#10;# print(f'\\n閉包: 10 + 5 = {add_5(10)}')"></textarea>
                <button class="run-code-btn" data-input="code-input-7" data-output="output-7" data-loading="loading-7" disabled>執行程式碼</button>
                 <span class="loading-indicator hidden" id="loading-7">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </span>
                <label class="block text-sm font-medium text-gray-700 mt-4 mb-1">輸出結果：</label>
                <pre id="output-7" class="output-area"></pre>
            </div>
        </section>

    </div>

    <script type="text/javascript">
        // 全局 Pyodide 實例
        let pyodideInstance = null;
        const globalLoadingIndicator = document.getElementById('globalLoadingIndicator');
        const globalLoadingText = document.getElementById('globalLoadingText');
        const allRunButtons = document.querySelectorAll('.run-code-btn');

        // --- Helper function to hide global indicator ---
        function hideGlobalLoadingIndicator() {
             globalLoadingIndicator.classList.add('hidden');
             globalLoadingIndicator.style.display = 'none';
        }

        // --- Helper function to show global indicator ---
        function showGlobalLoadingIndicator(message) {
            globalLoadingText.textContent = message;
            globalLoadingIndicator.classList.remove('hidden');
            globalLoadingIndicator.style.display = 'block';
        }

        // 將字串添加到指定的輸出區域
        function addToOutput(outputElement, s) {
            if (outputElement) {
                outputElement.textContent += s;
                // 自動滾動到底部
                outputElement.scrollTop = outputElement.scrollHeight;
            } else {
                console.error("addToOutput: outputElement is null or undefined");
            }
        }

        // 清除指定的輸出區域
        function clearOutput(outputElement) {
             if (outputElement) {
                outputElement.textContent = '';
            }
        }

        // 處理 Python 的 input() 函數
        function stdinPrompt(outputElement, promptMessage = '') {
            const result = window.prompt(promptMessage);
            if (promptMessage) {
                 addToOutput(outputElement, promptMessage);
            }
            if (result !== null) {
                 addToOutput(outputElement, result + '\n');
                 return result;
            } else {
                 // 使用者取消輸入，回傳空字串或引發錯誤，這裡回傳空字串
                 addToOutput(outputElement, '\n');
                 return "";
            }
        }

        // 主要的異步函數，用於載入和初始化 Pyodide
        async function initializePyodide() {
            console.log("Initializing Pyodide...");
            showGlobalLoadingIndicator('⏳ 正在初始化 Pyodide 環境，請稍候...');
            try {
                pyodideInstance = await loadPyodide();
                console.log("Pyodide loaded.");

                // 設置全局輸出/錯誤處理 (如果需要，但通常在執行時單獨設置)
                // pyodideInstance.setStdout({ batched: (s) => console.log("Global stdout:", s) });
                // pyodideInstance.setStderr({ batched: (s) => console.error("Global stderr:", s) });

                // 啟用所有執行按鈕
                allRunButtons.forEach(button => button.disabled = false);
                hideGlobalLoadingIndicator();
                console.log("Pyodide ready.");

            } catch (error) {
                console.error("Pyodide loading error:", error);
                showGlobalLoadingIndicator(`❌ Pyodide 初始化失敗: ${error}`);
                // 保持按鈕禁用狀態
            }
        }

        // 為所有執行按鈕添加點擊事件監聽器
        allRunButtons.forEach(button => {
            button.addEventListener('click', async () => {
                if (!pyodideInstance) {
                    alert('錯誤：Pyodide 尚未初始化。請稍候或重新整理頁面。');
                    return;
                }

                const inputId = button.dataset.input;
                const outputId = button.dataset.output;
                const loadingId = button.dataset.loading;

                const codeInput = document.getElementById(inputId);
                const outputElement = document.getElementById(outputId);
                const loadingIndicator = document.getElementById(loadingId);

                if (!codeInput || !outputElement || !loadingIndicator) {
                    console.error("Could not find corresponding elements for button:", button);
                    alert("發生內部錯誤，無法找到程式碼或輸出區域。");
                    return;
                }

                const pythonCode = codeInput.value;
                clearOutput(outputElement);
                addToOutput(outputElement, "🚀 開始執行程式碼...\n------\n");
                button.disabled = true;
                loadingIndicator.classList.remove('hidden');

                try {
                    // 為這次執行設置特定的 stdout, stderr, stdin
                    pyodideInstance.setStdout({
                        batched: (s) => addToOutput(outputElement, s + "\n")
                    });
                    pyodideInstance.setStderr({
                        batched: (s) => addToOutput(outputElement, s + "\n")
                    });
                    // 創建一個綁定了當前 outputElement 的 input 處理函數
                    const currentStdinPrompt = (promptMsg = '') => stdinPrompt(outputElement, promptMsg);
                    pyodideInstance.globals.set("input", currentStdinPrompt);

                    // 執行程式碼
                    await pyodideInstance.loadPackagesFromImports(pythonCode); // 自動載入 import 的套件
                    await pyodideInstance.runPythonAsync(pythonCode);
                    addToOutput(outputElement, "\n------\n✅ 程式碼執行完畢。\n");
                } catch (error) {
                    addToOutput(outputElement, `\n------\n❌ 執行錯誤:\n${error}\n`);
                    console.error("Python execution error:", error);
                } finally {
                    button.disabled = false;
                    loadingIndicator.classList.add('hidden');
                    // 清理或重置 stdout/stderr/stdin (如果需要的話，但通常下次執行會覆蓋)
                    // pyodideInstance.setStdout({});
                    // pyodideInstance.setStderr({});
                    // pyodideInstance.globals.delete("input");
                }
            });
        });

        // 為所有顯示答案按鈕添加事件監聽器
        document.querySelectorAll('.toggle-answer-btn').forEach(button => {
            button.addEventListener('click', () => {
                const answersDiv = button.nextElementSibling; // 假設答案 div 緊跟在按鈕後面
                if (answersDiv && answersDiv.classList.contains('answers')) {
                    answersDiv.classList.toggle('hidden');
                    button.textContent = answersDiv.classList.contains('hidden') ? '顯示答案' : '隱藏答案';
                }
            });
        });

        // 讓 .practice-area textarea 支援 Tab / Shift‑Tab (含多行選取)
        document.querySelectorAll('.practice-area textarea').forEach(t => {
        t.addEventListener('keydown', e => {
            if (e.key !== 'Tab') return;           // 只攔 Tab
            e.preventDefault();                    // 阻止預設行為（跳焦點）

            const indent = '    ';                 // 想用 \t 就改成 '\t'
            const { selectionStart: start, selectionEnd: end } = t;
            const value = t.value;
            const before = value.slice(0, start);
            const selection = value.slice(start, end);
            const after  = value.slice(end);

            // 判斷選取範圍的起始、結束行
            const lineStart = before.lastIndexOf('\n') + 1;      // 找到本行開頭
            const lineEnd   = end < value.length
                                ? value.indexOf('\n', end)
                                : value.length;                  // 找到最後一行結尾

            // 把要處理的區塊拆成行陣列
            const lines = value
            .slice(lineStart, lineEnd)
            .split('\n');

            if (!e.shiftKey) {
            // ─────────── Tab：整批縮排 ───────────
            for (let i = 0; i < lines.length; i++) {
                lines[i] = indent + lines[i];
            }
            const newBlock = lines.join('\n');
            t.value = value.slice(0, lineStart) + newBlock + value.slice(lineEnd);

            // 更新游標／選取
            if (selection.length === 0) {
                t.selectionStart = t.selectionEnd = start + indent.length;
            } else {
                t.selectionStart = start + indent.length;
                t.selectionEnd   = end   + indent.length * lines.length;
            }
            } else {
            // ─────────── Shift+Tab：整批反縮排 ───────────
            let removed = 0;
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith(indent)) {
                lines[i] = lines[i].slice(indent.length);
                removed++;
                } else if (lines[i].startsWith('\t')) {
                lines[i] = lines[i].slice(1);
                removed++;                       // 如果前面用 \t
                }
            }
            const newBlock = lines.join('\n');
            t.value = value.slice(0, lineStart) + newBlock + value.slice(lineEnd);

            // 更新游標／選取
            if (selection.length === 0) {
                t.selectionStart = t.selectionEnd = Math.max(start - indent.length, lineStart);
            } else {
                const delta = indent.length * removed;
                t.selectionStart = start - Math.min(indent.length, start - lineStart);
                t.selectionEnd   = end   - delta;
            }
            }
        });
        });


        // 當頁面載入完成後，開始初始化 Pyodide
        window.onload = initializePyodide;
    </script>
</body>
</html>
