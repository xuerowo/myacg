<!DOCTYPE html><html lang=zh-TW><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>閱讀章節 - 魔法學院的閃現天才 - 網漫翻譯</title><link rel=icon href=/images/favicon.jpg type=image/jpg><script src=https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js></script><style>:root{--primary-color:#4a90e2;--secondary-color:#f5f5f5;--text-color:#333;--background-color:#fff}:root[data-theme=dark]{--primary-color:#64b5f6;--secondary-color:#1a1a1a;--text-color:#e0e0e0;--background-color:#121212}*{margin:0;padding:0;box-sizing:border-box;transition:background-color .3s}body{background-color:var(--secondary-color);color:var(--text-color)}.reader-container{max-width:800px;margin:0 auto;padding-bottom:60px}.manga-page{width:100%;height:auto;margin:0;display:block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none}.loading{text-align:center;padding:2rem;color:var(--text-color);font-size:1.2rem}.reader-controls{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,.8);padding:1rem;display:flex;justify-content:center;gap:1rem;transition:transform .3s;z-index:1000}.reader-controls.hidden{transform:translateY(100%)}.control-btn{padding:.5rem 1rem;border:none;border-radius:4px;background:var(--primary-color);color:#fff;cursor:pointer;min-width:80px}.control-btn:hover{background:#357abd}.control-btn:disabled{opacity:.5;cursor:not-allowed}.back-btn{background:0 0;min-width:auto;padding:.5rem}.back-btn:hover{background:0 0;color:var(--primary-color)}.header-bar{position:fixed;top:0;left:0;right:0;background:rgba(0,0,0,.8);color:#fff;padding:.5rem;z-index:1000;transition:transform .3s}.header-bar.hidden{transform:translateY(-100%)}.header-bar-inner{display:flex;justify-content:space-between;align-items:center;max-width:800px;margin:0 auto;position:relative}.header-bar-inner>span{position:absolute;left:50%;transform:translateX(-50%)}.chapter-menu{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);width:300px;max-height:400px;background:rgba(0,0,0,.9);border-radius:8px;overflow-y:auto;z-index:1000;transition:transform .3s ease-out}.chapter-menu.hidden{transform:translate(-50%,200%)}.chapter-menu-header{position:sticky;top:0;padding:1rem;background:rgba(0,0,0,.9);border-bottom:1px solid #444;font-weight:700;text-align:center;color:#fff}.chapter-menu-list{padding:.5rem}.chapter-menu-item{padding:.75rem 1rem;cursor:pointer;border-radius:4px;color:#fff;margin-bottom:.25rem;display:flex;flex-direction:column;gap:.25rem}.chapter-menu-item:hover{background:var(--primary-color)}.chapter-menu-item.current{background:var(--primary-color)}.chapter-menu-item.read{opacity:.5}.chapter-date{font-size:.85rem;opacity:.8}.nav-controls{display:flex;gap:1rem;align-items:center;color:#fff;margin-left:auto}.toggle-switch{position:relative;display:inline-block;width:50px;height:24px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;border-radius:24px;transition:.4s}.toggle-slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background-color:#fff;border-radius:50%;transition:.4s}input:checked+.toggle-slider{background-color:var(--primary-color)}input:checked+.toggle-slider:before{transform:translateX(26px)}</style></head><body><div id=app><div class=header-bar :class="{ hidden: hideControls }"><div class=header-bar-inner><button class="control-btn back-btn" @click=goToDetail>&lt;</button> <span>第{{ currentChapter }}話</span><div class=nav-controls><label class=toggle-switch><input type=checkbox v-model=isDarkMode> <span class=toggle-slider></span></label> <span>夜間模式</span></div></div></div><div v-if=loading class=loading>載入中...</div><div v-else class=reader-container><div v-if=error class=error-message>{{ error }}</div><img v-for="page in pages" :key=page :src=page class=manga-page loading=lazy @load=handleImageLoad @error="handleImageError($event, page)" contextmenu="return false;" oncontextmenu=return!1 onselectstart=return!1 ondragstart=return!1></div><div v-if=showChapterMenu class=chapter-menu :class="{ hidden: hideControls }"><div class=chapter-menu-header>章節目錄</div><div class=chapter-menu-list><div v-for="chapter in allChapters" :key=chapter.number class=chapter-menu-item :class="{
                         current: chapter.number === currentChapter,
                         read: isChapterRead(chapter.number)
                     }" @click=goToChapter(chapter.number)><div>第{{ chapter.number }}話</div><div class=chapter-date>{{ formatDate(chapter.date) }}</div></div></div></div><div class=reader-controls :class="{ hidden: hideControls }"><button class=control-btn @click=goToPrevious :disabled=!hasPrevious>上一話</button> <button class=control-btn @click=toggleChapterMenu>目錄</button> <button class=control-btn @click=goToNext :disabled=!hasNext>下一話</button></div></div><script>let MANGA_INFO={title:"魔法學院的閃現天才",baseUrl:"https://pub-1439fd98492f4d39a19299ba219c45de.r2.dev/"+encodeURIComponent("魔法學院的閃現天才")},STORAGE_KEYS={READ_CHAPTERS:"read_chapters",SCROLL_POSITION:"chapter_scroll_position",THEME:"theme"},createApp=Vue.createApp;createApp({data(){return{currentChapter:0,pages:[],hideControls:!1,lastScrollTop:0,scrollTimeout:null,loading:!0,loadedImages:0,showChapterMenu:!1,allChapters:[],isDarkMode:"dark"===localStorage.getItem(STORAGE_KEYS.THEME),error:null,retryCount:{},maxRetries:3}},computed:{hasNext(){return this.allChapters.some(t=>t.number>this.currentChapter)},hasPrevious(){return this.allChapters.some(t=>t.number<this.currentChapter)}},watch:{isDarkMode(t){t=t?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem(STORAGE_KEYS.THEME,t)}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"):""},async loadChapterData(){try{var t=await(await fetch("chapters.json")).json(),e=(this.allChapters=t.chapters.sort((t,e)=>e.number-t.number),this.allChapters.find(t=>t.number===this.currentChapter));if(!e)throw new Error("找不到此章節");this.pages=Array.from({length:e.total},(t,e)=>`${MANGA_INFO.baseUrl}/${this.currentChapter}/${e+1}.jpg?v=`+Date.now()),this.markAsRead()}catch(t){console.error("載入章節失敗:",t),this.error="載入章節失敗，請稍後再試",setTimeout(()=>{window.location.href="webtoondetail.html"},3e3)}finally{this.loading=!1}},handleImageLoad(){this.loadedImages++,this.loadedImages===this.pages.length&&this.restoreScrollPosition()},handleImageError(t,e){this.retryCount[e]=(this.retryCount[e]||0)+1,this.retryCount[e]<=this.maxRetries?t.target.src=e.split("?")[0]+"?v="+Date.now():(console.error("圖片載入失敗:",e),this.error="部分圖片載入失敗，請稍後重試")},goToDetail(){sessionStorage.removeItem(STORAGE_KEYS.SCROLL_POSITION),window.location.href="webtoondetail.html"},toggleChapterMenu(){this.showChapterMenu=!this.showChapterMenu,this.showChapterMenu&&(this.hideControls=!1)},saveScrollPosition(){var t=MANGA_INFO.title,e=JSON.parse(sessionStorage.getItem(STORAGE_KEYS.SCROLL_POSITION)||"{}");e[t]||(e[t]={}),e[t][this.currentChapter]=window.pageYOffset,sessionStorage.setItem(STORAGE_KEYS.SCROLL_POSITION,JSON.stringify(e))},restoreScrollPosition(){var t=MANGA_INFO.title,t=(JSON.parse(sessionStorage.getItem(STORAGE_KEYS.SCROLL_POSITION)||"{}")[t]||{})[this.currentChapter];void 0!==t&&window.scrollTo(0,parseInt(t))},goToChapter(t){t!==this.currentChapter&&(this.saveScrollPosition(),window.location.href="chapter.html?chapter="+t),this.showChapterMenu=!1},goToNext(){var t;this.hasNext&&(t=this.allChapters.filter(t=>t.number>this.currentChapter).reduce((t,e)=>e.number<t.number?e:t),this.saveScrollPosition(),window.location.href="chapter.html?chapter="+t.number)},goToPrevious(){var t;this.hasPrevious&&(t=this.allChapters.filter(t=>t.number<this.currentChapter).reduce((t,e)=>e.number>t.number?e:t),this.saveScrollPosition(),window.location.href="chapter.html?chapter="+t.number)},handleScroll(){clearTimeout(this.scrollTimeout);var t=window.pageYOffset||document.documentElement.scrollTop,e=t>this.lastScrollTop,r=window.innerHeight+window.pageYOffset>=document.body.offsetHeight-100;e&&!r?(this.hideControls=!0,this.showChapterMenu=!1):this.hideControls=!1,this.lastScrollTop=t,this.saveScrollPosition()},isChapterRead(t){return JSON.parse(localStorage.getItem(STORAGE_KEYS.READ_CHAPTERS)||"{}")[MANGA_INFO.title]?.includes(t)},markAsRead(){var t=JSON.parse(localStorage.getItem(STORAGE_KEYS.READ_CHAPTERS)||"{}");t[MANGA_INFO.title]||(t[MANGA_INFO.title]=[]),t[MANGA_INFO.title].includes(this.currentChapter)||(t[MANGA_INFO.title].push(this.currentChapter),localStorage.setItem(STORAGE_KEYS.READ_CHAPTERS,JSON.stringify(t)))}},async mounted(){var t=localStorage.getItem(STORAGE_KEYS.THEME)||"light",t=(document.documentElement.setAttribute("data-theme",t),this.isDarkMode="dark"===t,new URLSearchParams(window.location.search)),t=parseInt(t.get("chapter"));t?(this.currentChapter=t,document.title=`第${t}話 - ${MANGA_INFO.title} - 網漫翻譯`,await this.loadChapterData(),window.addEventListener("scroll",this.handleScroll)):(this.error="無效的章節號",setTimeout(()=>{window.location.href="webtoondetail.html"},3e3))},unmounted(){window.removeEventListener("scroll",this.handleScroll)}}).mount("#app")</script></body></html>
